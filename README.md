# calendar_bot
***

### Краткое описание
Телеграм бот для просмотра событий из гугл календаря.<br>
А также получения уведомлений о добавлении, удалении или изменении событий.

### Команды бота
- /menu (доступна всем группам пользователей)
  - Выводит инлайн клавиатуру с кнопкапи
    - next (Ближайшее событие)<br>Показывает описание ближайшего события в календаре
    - list (Список событий)<br>Выводит инлайн клавиатуру каждая кнопка в котороый это отдельное событие из календаря<br>
    События упорядочены по дате, сверху самое ближайшее.<br>
    Нажав на кнопку с интересующим событием будет показано описание события.
- /admin (доступна только администраторам/суперюзерам)
  - /new_user
    - Добавляет нового пользователя в список тех, кому разрешено пользоваться ботом.
      1. Вводим id ползователя, который он должен предоставить(9ти значное число)
      2. Вводим имя пользователя(на свое усмотрение, не длиннее 20 символов).
  - /user_list 
    - выведет список всех пользователей в виде клавиатуры с именами пользователей.
      1. Нажми на пользователя
      2. Подтверди его удаление.<br>
    - Удаленный пользователь больше не сможет пользоваться ботом.

### Запуск

Для работы бота нужно создать google service account.<br>
Добавить этот аккаунт в календарь из которого будут считываться события.<br>
Создать credentials(keyfile.json) и поместить его в app/core/google.<br>
[читай документацию](https://developers.google.com/workspace/guides/create-credentials#service-account)

#### Локально/для разработки
  1. В папке config/dev создаем .env файл и заполняем его как показано в .env.example
  2. Выполняем команду
       ```
         make run_dev
       ```
  3. Добавляем себя в базу как админа
       ```
       curl -X 'POST' \
         'http://127.0.0.1:8000/api/v1/users/add_user' \
         -H 'accept: application/json' \
         -H 'Content-Type: application/json' \
         -d '{
         "user_id": "telegram id",
         "name": "name",
         "role": "admin"
       }'
       ```
#### Запуск с вебхуком на сервере
  1. В папке config/prod создаем .env файл и заполняем его как показано в .env.example
  2. Создаем ```.key и .pem``` файлы, инструкция [тут](https://core.telegram.org/bots/self-signed),<br>
помещаем созданные файлы в папки как указано в ```config/prod/nginx/conf.d/tg_bot.conf```
  3. Выполняем команду
       ```
         make run_prod
       ```
  4. Добавляем себя в базу как админа
       ```
       curl -X 'POST' \
         'http://127.0.0.1:8000/api/v1/users/add_user' \
         -H 'accept: application/json' \
         -H 'Content-Type: application/json' \
         -d '{
         "user_id": "telegram id",
         "name": "name",
         "role": "admin"
       }'
       ```